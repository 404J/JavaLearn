# Day05

## 持久化

### RDB: 定时保存快照副本文件

> 如何实现 service 非阻塞的持久化数据？

知识储备：

1. Linux 分为父子进程，且父子进程间的数据互不影响。
2. 使用 fork(系统调用) 创建子进程的时候，子进程中只是拷贝数据的引用，创建子进程速度很快，且占用空间小。当父进程修改数据时候，子进程会 copy on write，保证进程间的数据隔离

redis 实现内存数据副本持久化：
某时刻，redis 使用 fork + copy on write 创建子进程，落地的数据为该时刻的数据，且父进程的数据发生更改不会影响子进程

* redis-cli 中使用 SAVE 窗口阻塞持久化
* redis-cli 中使用 BGSAVE 后台使用 fork 持久化
* 配置文件配置

#### 弊端

* 只有一个 RDB 文件，需要人为定时 copy
* 不是实时落地，间隔时间数据可能丢失

### AOF: 实时记录写操作日志

AOF, append only file。AOF 恢复数据较慢。

#### 弊端和解决

* 体量大
* 恢复慢

> 解决

## 主从复制
