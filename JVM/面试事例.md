# JVM 调优事例

## 内存溢出

- 现象：ETC跨场景模块的 server 定时的会出现内存使用率飙高现象，甚至出现内存溢出现象
- 分析：由于配置了 HeapDumpOnOutOfMemoryError 启动参数，可以拿到堆内存的快照，使用 jhat 分析堆内存对象，发现了是 max-http-header-size 配置过大，然后又因为该模块的一个行业方会在某个时间段进行大量的扣款请求到达，导致内存中创建大量的inputbuffer和outputbuffer，导致内存溢出，但是配置过小，会有接口出现 Request header is too large， 因为有批量代扣的接口

## 内存升级系统变慢

- 现象：系统业务增多，打算扩大内存，但是内存扩大之后，log 出现了多次超时的现象
- 分析：分析 gc 日志的时候发现，此时正在 gc，且时间过长，导致超时。因为内存变大，gc 频率降低，但是单次 gc 时间过长。后期采用 CMS
