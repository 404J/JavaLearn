# Day04

## 对象的内存布局

### 对象的创建过程

- 如果 class 未加载，首先加载
- 申请对象内存
- 成员变量赋默认值
- 调用构造方法：成员变量赋初始值，执行动态代码块，执行构造方法语句

### 对象在内存中的存储布局

- 普通对象
  1. 对象头 markword 8个字节
  2. classpoint 指针，指向 class 对象, 4/8个字节
  3. 实例数据
  4. 对齐为8的倍数

- 数组对象
  1. 对象头 markword 8个字节
  2. classpoint 指针，指向 class 对象, 4/8个字节
  3. 数组的长度 4个字节
  4. 数组的数据
  5. 对齐

> 1个字节(byte) = 8位(bit)

- 对象头具体包含内容
  1. 锁的状态
  2. GC 的状态

- 对象定位：T t = new T(), t 如何找到内存中的 T 对象
  1. 句柄池: t 指向一个目标，该目标指向 new T() 和 T.class，如果 GC 时候实例数据位置移动了，只需改变句柄池的指向，不用改变 t 的指向
  2. 直接指针: t 直接指向 new T(), new T() 指向 T.class, 速度快，但是 t 的指向可能会变，Hotspot 采用这种方式
